# 并发

# 多线程


- 状态：
  - 全局变量、堆区：所有线程共享
  - 栈帧：每个线程独自维护自己的栈帧链
- 多线程状态转移：不同栈帧链间并行执行，同一条栈帧链串行执行，且栈帧链之间互不影响

**线程的创建：** 就是在状态机中，新增加一条栈帧链表

**线程 Join：** 一条栈帧链，循环等待被 Join 的栈帧链执行完毕


线程局部变量

```cpp
// GCC 关键字
// 只适用于整型指针的标量，不带自定义的构造、拷贝、赋值、析构的类型；
// 不能修饰函数的局部变量或者class的普通成员变量
__thread int n;

// c11 标准，比上面那个好用
thread_local int n;
```

**问题**

- 原子性

- 顺序性：编译器编译程序，会将所有的代码视作单线程编译汇编语句，这样就会对代码进行乱七八糟的优化

- 可见性：指令也会乱运行



