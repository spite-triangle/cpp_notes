# Zookeeper

# 概念

## 介绍

[zookeeper](https://zookeeper.readthedocs.io/zh/latest/intro.html): 是一个开源的分布式协调服务，广泛应用于分布式系统中。它采用树形目录结构，提供统一命名服务、配置管理、分布式锁、集群管理等功能，确保数据一致性和高可用性。
- 通用的分布式框架
- 支持复制

![alt|c,50](../../image/disturbute/zookeeper_structure.png)

`zookeeper` 主要结构如图
- `ZK app` : zookeeper 的应用层，以服务的形式提供，用于处理客户端业务逻辑
- `ZAB` : 一套实现了类似 `Raft` 算法机制的系统，用于支持 `ZK app` 的「复制」部署能力

## ZAB vs Raft

但 `ZAB` 与 `Raft` 有着显著差异：**`ZAB`允许 `follower` 节点响应用户的「读操作」，而 `Raft` 只允许 `leader` 处理用户请求与响应** 。`Raft` 算法无法通过增加节点机器，使得读/写操作加速（可能还会不如单机性能），而 `ZAB` 随着节点机器的增加，会大大增强「读操作」性能。**但代价是 `ZAB` 并不保证系统读/写操作「强一致性」。**


## 一致性

`zookeeper` 虽然舍弃「强一致性」换来了「读操作」的性能提升，但也不是完全放弃了读/写操作的一致性，其保证
- 写操作一定是线性化的：对于同一状态，系统不会同时执行两个写操作，写操作具有先后顺序
- 在客户端视角，zookeeper 会按照 `FIFO` 的顺序执行客户端的读/写操作请求并响应
  - 先写后读情况：备节点会等待主节点执行完相邻的写操作后，才执行读操作


> [!tip]
> `zookeeper` 只保证了同一客户端读/写操作的「强一致性」，而非整个系统
> - 每个客户端是独立线程
> - `state` 是全局变量
> 在 zookeeper 系统下，这些线程操作 `state` 没加锁



