# 分布式事务

# 概念

## 事务

**事务`transaction`** : 通常会将能实现并发控制 `concurrency control` 与原子提交 `atomic commit` 的机制称之为事务，即在可并发的系统中，用户提交的一系列操作可以原子的执行。
- 并发控制 `concurrency control`: 多个事务并发时，保证各个事务读/写相同数据时，正确操作
- 原子提交 `atomic commit`: 事务中的操作要么都成功，要么都失败，**不允许出现部分成功的情况**


在数据库中，一个可行的事务系统需要满足以下条件
- **原子性 `Atomic`**: 事务中的操作要么都成功，要么都失败
- **一致性 `Consistent`**: 事务提交前后只存在两个状态，提交前的状态和提交后的状态，绝对不会出现中间的状态
- **独立性 `Isolation`**: 对于任意两个并发的事务`T1`和`T2`，在事务`T1`看来，`T2`要么在`T1`开始之前就已经结束，要么在`T1`结束之后才开始。每个事务都感觉不到有其他事务在并发地执行。
  - **可序列化 `serializable`**: 多个并发执行的事务会生成一组结果输出序列，而针对这组结果序列，可以找到一组能与之对应的事务串行执行序列。例如 `T1 -> R1`，`T2 -> R2,R3`, `T3 -> R4` 三个事务同时执行的输出结果序列为 `R4,R1,R2,R3`，当事务按照 `T3,T1,T2` 的顺序串行执行时也会产生 `R4,R1,R2,R3` 序列结果
- **持久化 `Durable`**: 事务一旦被提交了，那么对数据库中的数据的改变就是永久性的

## 中止

**中止`abort`**: 事务由于某种原因，在执行过程中失败。出现中止问题后，就需要系统具有优秀的故障处理系统，实现事务的 「原子性」与「一致性」 
- **撤销 `undo`**: 事务执行失败，恢复被事务修改的数据
- **重做 `redo`**: 事务执行成功，但数据库崩溃，`cache` 中的数据未及时落盘，数据库重启后重新执行事务

# 并发控制

